SELECT c2.visited_on, c2.amount, ROUND(c2.amount / 7,2) AS average_amount
FROM (
      SELECT c1.visited_on, SUM(c1.amount) OVER (ORDER BY visited_on ROWS 6 PRECEDING) AS amount
      FROM (
            SELECT visited_on, SUM(amount) AS amount
            FROM Customer
            GROUP BY visited_on
           ) AS c1
     ) AS c2
WHERE DATEDIFF(c2.visited_on, (SELECT MIN(visited_on) FROM Customer)) >= 6
ORDER BY c2.visited_on;

Note: 注意窗口函数的使用
